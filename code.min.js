var casemap=!1;$.ajaxSetup({async:!1}),$.fn.dataTable.ext.errMode="none";var crm_Setpersonid="",crm_Setremember="",crm_Setrecordtype="",crm_Setcaseid="",crn_persondetayid="";function getCRMCasesAll(e,a,t,r,o,i){null==e&&(e=""),null==a&&(a=""),null==t&&(t=""),null==r&&(r=""),null==o&&(o=""),null==i&&(i="");$("#examplecrm").DataTable({responsive:!0,ordering:!0,searching:!1,pageLength:50,destroy:!0,serverSide:!0,processing:!0,order:[[0,"desc"]],language:{url:"/assets/turkish.json"},ajax:{url:serviceurl+"?method=crm_getCRMCasesAll&token="+token+"&startdate="+e+"&enddate="+a,type:"GET",data:function(e){e.durum=t,e.siratip=r,e.searchvalue=o,e.kayittip=i}},columns:[{data:"0",mRender:function(e,a,t){var r=t[0],o=t[9];if(null==o)var i="#"+r+" - "+t[1];else i="#"+r+" - "+t[1]+" (Flexity Dosya No: "+o+")";var n=t[10],s=t[11];return"true"!=n&&($("#kisi_birlestir").hide(),"true"==s||$(".crm_detail_kayittip").attr("style","display:none !important;")),"<a onclick='crm_casedetayid="+r+';fileUploadType=1;Url2Modal("modules/crm/case_detail.html","'+i+"\")' class='text-info' ><i class='fa fa-2x fa-edit'></i></a>"}},{data:"1",mRender:function(e,a,t){if(""!=t[1]){var r=t[0],o=t[1],i=t[2],n=t[3],s=t[4],l=t[5];if(""!=t[7]){var c=t[7].split("-"),d=t[8],m=c[0],p=c[1],u=t[9],_="";"t"==d&&(_='<span class="card gradient-strawberry d-block d-lg-none" data-toggle="tooltip" title="Flexity Dosya No:('+u+')" style="padding:2px;font-size:12px !important;color:#fff;width:20px !important;text-align:center; display:inline-block" title="Flexity Aktarımı Yapıldı">F</span>');var g='<span class="d-block d-lg-none" style="font-size:11px;border-radius:4px;font-weight:bold;color:#fff;padding:4px;background-color: '+p+'">'+m+"</span> "+_}var y='<span style="font-size:11px; white-space:initial;font-weight: bold;">'+o+'</span><span style="font-size:12px;line-height:20px;height:20px;overflow:hidden;display:block;color:#666;">'+s+"</span>"+('<span class="d-block d-lg-none" style="font-size:12px;line-height:20px;height:20px;overflow:hidden;display:block;color:#666;">'+i+"</span>")+('<span class="d-block d-lg-none" style="font-size:12px;line-height:20px;height:20px;overflow:hidden;display:block;color:#666;">'+n+"</span>")+('<span class="d-block d-lg-none" style="font-size:12px;line-height:20px;height:20px;overflow:hidden;display:block;color:#666;">'+l+" <b>(İşlem No: "+r+")</b></span>")+g;r=t[0];if(null==(u=t[9]))var f="#"+r+" - "+t[1];else f="#"+r+" - "+t[1]+" (Flexity Dosya No: "+u+")";return"<a onclick='crm_casedetayid="+r+';fileUploadType=1;Url2Modal("modules/crm/case_detail.html","'+f+"\")' class='text-info' >"+y+"</a>"}}},{data:"2"},{data:"3"},{data:"5"},{data:"6"},{data:"0"},{data:"8",mRender:function(e,a,t){if(""!=t[7]){var r=t[7].split("-"),o=t[8],i=r[0],n=r[1],s=t[9],l="";return"t"==o&&(l='<span class="card gradient-strawberry" data-toggle="tooltip" title="Flexity Dosya No:('+s+')" style="padding:2px;font-size:12px !important;color:#fff;width:20px !important;text-align:center; display:inline-block" title="Flexity Aktarımı Yapıldı">F</span>'),'<span style="font-size:11px;border-radius:4px;font-weight:bold;color:#fff;padding:4px;background-color: '+n+'">'+i+"</span> "+l}}}],columnDefs:[{width:"3%",orderable:!1,"max-width":"30px",targets:0},{width:"18%",orderable:!1,targets:1},{width:"10%",orderable:!1,targets:2},{width:"7%",orderable:!1,targets:3},{width:"5%",orderable:!1,"max-width":"50px;",targets:4},{width:"7%",orderable:!1,targets:5},{width:"3%",orderable:!1,targets:6},{width:"5%",orderable:!1,className:"onem",targets:7}]})}function getCRMCaseLook(e){$.getJSON(serviceurl+"?method=crm_getCRMCaseLook&token="+token+"&personid="+e,function(e){$.each(e,function(e,a){$("#crmkayit_muhatapad").val(a.ad+" "+a.soyad),$("#crmkayit_muhatapkimlikno").val(a.tc_no),$("#crmkayit_muhatapbabaad").val(a.baba_adi),$("#crmkayit_muhatapanaad").val(a.ana_adi),$("#crmkayit_muhatapdgmtrh").val(a.dogumtarih),$("#crmkayit_muhatapdgmyer").val(a.dogum_yeri),$("#crmkayit_muhatapevtel").val(a.ev_tel_no),$("#crmkayit_muhatapceptel").val(a.cep_tel_no),$("#crmkayit_muhatapistel").val(a._is_tel_no),$("#crmkayit_muhatapeposta").val(a.e_posta),$("#crmkayit_muhatapmeslek").val(a.meslek),$("#crmyenikayit_muhatapad").val(a.ad),$("#crmyenikayit_muhatapsoyad").val(a.soyad),$("#crmyenikayit_muhatapkimlikno").val(a.tc_no),$("#crmyenikayit_muhatapbabaad").val(a.baba_adi),$("#crmyenikayit_muhatapanaad").val(a.ana_adi),$("#crmyenikayit_muhatapdogumyer").val(a.dogum_yeri),$("#crmyenikayit_muhatapdgmtrh").val(a.dogumtarih),$("#crmyenikayit_muhatapevtel").val(a.ev_tel_no),$("#crmyenikayit_muhatapceptel").val(a.cep_tel_no),$("#crmyenikayit_muhatapistel").val(a._is_tel_no),$("#crmyenikayit_muhatapeposta").val(a.e_posta),$("#crmyenikayit_muhatapmeslek").val(a.meslek),$("#crmkayit_casemuhatap").val(a.ad+" "+a.soyad)})})}function showModalDetail(e,a,t,r){""!=t&&window.localStorage.setItem("crm_personid",t),""!=r&&window.localStorage.setItem("crm_caseid",r),null==a&&(a=""),window.localStorage.setItem("talepmodaltitle",a);var o=$(window).width()/2+100;showModal(e,a,"",o,"","","","")}function getCRMCaseCount(e,a){$.getJSON(serviceurl+"?method=crm_getCRMCaseCount&token="+token+"&personid="+e+"&type="+a,function(e){$.each(e,function(e,a){return a.sayi})})}function getCRMCaseLookTable(e){window.localStorage.removeItem("crm_caseid"),$.ajaxSetup({async:!0});$("#example").DataTable({responsive:!0,serverSide:!0,order:[[0,"asc"]],pageLength:10,destroy:!0,processing:!0,order:[[0,"desc"]],language:{url:"/assets/turkish.json"},ajax:{url:serviceurl+"?method=crm_getCRMCaseLookTable&token="+token+"&muhatapbilgi="+e,type:"GET",data:function(e){}},columns:[{data:"0",mRender:function(e,a,t){var r=t[0];return"1"==t[8]?r+" <img src='/modules/crm/images/checkmark.png' width='30' style='text-align: center' title='Onaylı Muhatap'/>":r}},{data:"1"},{data:"2"},{data:"3",mRender:function(e,a,t){return"<a>"+t[4]+" kayıt bulundu</a>"}},{data:"4",mRender:function(e,a,t){var r=t[3];t[0];return"<span class='btn btn-warning text-center text-white' onclick='openCRMNewRecord("+r+',1);\'>Yeni Kayıt <span class="fa fa-plus-circle"></span></span>'}},{data:"5",mRender:function(e,a,t){var r=t[3];return"<span class='btn btn-primary text-center text-black' onclick='crm_persondetayid="+r+';Url2Modal("modules/crm/person_detail.html","'+(t[0]+" - Detay")+'",'+r+')\'>Detay <span class="fa fa-edit"></span></span>'}}],columnDefs:[{width:"30%",orderable:!1,targets:0},{width:"10%",orderable:!1,className:"onem",targets:1},{width:"10%",orderable:!1,targets:2},{width:"5%",orderable:!1,className:"onem",targets:3},{width:"5%",orderable:!1,className:"onem",targets:4},{width:"5%",orderable:!1,className:"onem",targets:5}]})}function getCRMCasePersonRecord(e){$("#examplepersoncase").DataTable({responsive:!0,serverSide:!0,order:[[0,"asc"]],pageLength:10,destroy:!0,processing:!0,order:[[0,"desc"]],language:{url:"/assets/turkish.json",processing:"<img src='img/loading.gif'> Loading..."},ajax:{url:serviceurl+"?method=crm_getCRMCasePersonRecord&token="+token+"&person_id="+e,type:"GET",data:function(e){}},columns:[{data:"6",mRender:function(e,a,t){var r=t[0],o=t[7];if(null==o)var i="#"+r+" - "+t[3];else i="#"+r+" - "+t[3]+" (Flexity Dosya No: "+o+")";return"<a onclick='crm_casedetayid="+r+';fileUploadType=1;Url2Modal("modules/crm/case_detail.html","'+i+"\")' class='text-info' ><i class='fa fa-2x fa-edit'></i></a>"}},{data:"0"},{data:"1"},{data:"2"},{data:"3"},{data:"4"},{data:"5",mRender:function(e,a,t){var r=t[5].split("-"),o=r[0],i=r[1],n=t[6],s=t[7],l="";return"t"==n&&(l='<span class="card gradient-strawberry" data-toggle="tooltip" title="Flexity Dosya No:('+s+')" style="padding:2px;font-size:12px !important;color:#fff;width:20px !important;text-align:center; display:inline-block" title="Flexity Aktarımı Yapıldı">F</span>'),'<span style="font-size:11px;border-radius:4px;font-weight:bold;color:#fff;padding:4px;background-color: '+i+'">'+o+"</span> "+l}}],columnDefs:[{width:"3%",orderable:!1,"max-width":"30px",targets:0},{width:"3%",orderable:!1,className:"onem",targets:1},{width:"40%",orderable:!1,targets:2},{width:"20%",orderable:!1,className:"onem",targets:3},{width:"10%",orderable:!1,className:"onem",targets:4},{width:"10%",orderable:!1,targets:5},{width:"50px",orderable:!1,className:"onem",targets:6}]})}function getCRMCaseBirim(){String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})};var e="",a=0,t="";$.getJSON(serviceurl+"?method=crm_getCRMCaseBirim&token="+token,function(r){$.each(r,function(r,o){e='<div class="card" style=\'margin:0;\'><div class="card-header" style=\'padding:12px 20px; background-color: rgba(0, 0, 0, 0.03);\'><h4 data-toggle="collapse" data-parent="#accordion" href="#collapse{2}" class="panel-title expand"><div class="right-arrow pull-right">+</div><a href="#">{0}</a></h4></div><div id="collapse{2}" class="panel-collapse collapse"><div class="card-body" style=\'padding:10px 0 0 15px;\'><div id="casebirimchild{2}"></div></div></div></div>',-1==t.indexOf(o.birim_adi)&&(a++,$(e.format(o.birim_adi,o.birim_adi,a)).appendTo("#casebirim"),t+=o.birim_adi,o.birim_adi),$(("<div class=\"radio radio-info\" onclick=\"$('#radio{0}').prop('checked', true);$('#crmkayit_casebasvurutip').val('{1}');window.localStorage.setItem('crm_case_type_id','{0}'); alertControl('.radio radio-info',1);\">"+'<input type="radio" name="radiobirim" class="radiobirim" id="radio{0}" required="required"><label for="radio{0}">{1}</label></div>').format(o.case_type_id,o.type_name)).appendTo("#casebirimchild"+a)})})}function alertControl(e,a){1==a?$(e).removeAttr("style"):$(e).attr("style","background-color: #ffbebe !important;border: 1px solid red;")}function postCRMPerson(e,a,t,r,o,i,n,s,l,c,d,m,p){crm_postDebugLog("POST_CRM_PERSON_STEP_2","Fonksiyona giriş yapıldı"),crm_postDebugLog("POST_CRM_PERSON_STEP_4","Doğrulama sonrası post person yönlendirmesine girildi"),crm_postDebugLog("POST_CRM_PERSON_STEP_4_1",serviceurl+"method=crm_postCRMPersontoken="+token+"param1="+e+"param2="+a+"param3="+t+"param4="+r+"param5="+o+"param6="+i+"param7="+n+"param8="+s+"param9="+l+"param10="+c+"param11="+d+"param12="+m+"param13="+p),crm_postDebugLog("POST_CRM_PERSON_STEP_4_ad",e),crm_postDebugLog("POST_CRM_PERSON_STEP_4_soyad",a),crm_postDebugLog("POST_CRM_PERSON_STEP_4_tcno",t),crm_postDebugLog("POST_CRM_PERSON_STEP_4_dogumtarih_last",n),$.getJSON(serviceurl+"?method=crm_postCRMPerson&token="+token+"&param1="+e+"&param2="+a+"&param3="+t+"&param4="+r+"&param5="+o+"&param6="+i+"&param7="+n+"&param8="+s+"&param9="+l+"&param10="+c+"&param11="+d+"&param12="+m+"&param13="+p,function(e){crm_postDebugLog("POST_CRM_PERSON_STEP_4_2","Dönüş yapıldı"),crm_postDebugLog("POST_CRM_PERSON_STEP_4_3",e[0]),$.each(e,function(e,a){crm_postDebugLog("POST_CRM_PERSON_STEP_4_4",a.person_id),window.localStorage.setItem("crm_personid",a.person_id),window.localStorage.setItem("postsuccess",a.postsuccess),window.localStorage.setItem("crm_remember",1),window.localStorage.setItem("crm_recordtype",1);var t=window.localStorage.getItem("postsuccess");if(crm_postDebugLog("POST_CRM_PERSON_STEP_5",a.postsuccess),crm_postDebugLog("---------","---------"),t>0)toastr.success("Muhatap kaydı oluşturuldu","BAŞARILI!"),$("#crmkaydet").removeAttr("disabled"),getCRMCaseLook(a.person_id),$("#muhatapkaydet").attr("disabled","disabled"),$("#step-1").hide(),$("#step-2").show(),$("#step1href").attr("class","btn btn-circle btn-default"),$("#step2href").attr("class","btn btn-circle btn-default btn-primary"),$("#step1href").attr("disabled","disabled"),$("#step2href").removeAttr("disabled"),$("#muhatapyokalert").hide();else{var r=a.message;null!=r&&""!=r?toastr.error(r,"DİKKAT!"):toastr.error("Muhatap kaydı sırasında bir hata oluştu, lütfen girdiğiniz alanları tekrar kontrol ediniz.","DİKKAT!"),$("#muhatapkaydet").removeAttr("disabled")}})})}function getCrmMahalle(){$.getJSON(serviceurl+"?method=crm_getCrmMahalle&token="+token,function(e){$.each(e,function(e,a){$("#crmkayit_casemahalle").append("<option value="+a.mah_cbno+">"+a.adi+"</option>")})})}function getCrmTest(){$.getJSON(serviceurl+"jsonservice/rest/?method=get_Content&group_id=1",function(e){alert(e.ip),$.each(e,function(e,a){})})}function getCrmCaddeSokak(e){$.getJSON(serviceurl+"?method=crm_getCrmCaddeSokak&param1="+e+"&token="+token,function(e){$.each(e,function(e,a){$("#crmkayit_casecaddesokak").append("<option value="+a.cs_cbno+">"+a.adi+" "+a.yolturu_ki+"</option>")})})}function getCrmBinaYapi(e,a){$.getJSON(serviceurl+"?method=crm_getCrmBinaYapi&param1="+e+"&param2="+a+"&token="+token,function(e){$.each(e,function(e,a){var t=a.adi;null!=t&&""!=t||(t="İSİMSİZ YAPI"),$("#crmkayit_casebina").append("<option value="+a.bina_uavtkod+">"+a.diskapino.replace(" ","")+"-"+t+"</option>"),$("#crmkayit_caseadreskonum").val(a.merkez)})})}function getCrmBinaIcKapi(e){$.getJSON(serviceurl+"?method=crm_getCrmBinaIcKapi&param1="+e+"&token="+token,function(e){$.each(e,function(e,a){$("#crmkayit_caseickapi").append("<option value="+a.ickapi_no+">"+a.ickapi_no+"</option>"),$("#crmkayit_caseadrestip").val(a.yapituru)})})}function postCRMCase(e,a,t,r,o,i,n,s,l,c,d,m,p,u,_,g,y){$.getJSON(serviceurl+"?method=crm_postCRMCase&token="+token+"&param1="+e+"&param2="+a+"&param3="+t+"&param4="+r+"&param5="+o+"&param6="+i+"&param7="+n+"&param8="+s+"&param9="+l+"&param10="+c+"&param11="+d+"&param12="+m+"&param13="+p+"&param14="+u+"&param15="+_+"&param16="+g+"&param17="+y,function(e){$.each(e,function(e,a){window.localStorage.setItem("crm_caseid",a.case_id),window.localStorage.setItem("postsuccess",a.postsuccess),window.localStorage.getItem("postsuccess")>0?(toastr.success("CRM kaydı oluşturuldu.","BAŞARILI!"),$("#crmkaydet").attr("disabled","disabled"),getCRMCase(a.case_id),crm_casedetayid=a.case_id,load_js("/app-assets/js/upload/demo-config.js"),window.localStorage.removeItem("crm_personid"),window.localStorage.removeItem("crm_remember"),window.localStorage.removeItem("crm_recordtype")):(toastr.error("CRM kaydı sırasında bir hata oluştu, lütfen girdiğiniz alanları tekrar kontrol ediniz.","DİKKAT!"),$("#crmkaydet").removeAttr("disabled"))})})}function getCRMCase(e,a){String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})},$.getJSON(serviceurl+"?method=crm_getCRMCase&param1="+e+"&token="+token,function(t){$.each(t,function(t,r){var o=r.statuscolor.split("-"),i='<span class="label" style="font-size:11px;border-radius:4px;font-weight:bold;color:#fff;padding:4px;background-color:'+o[1]+'">'+o[0]+"</span>";if(1==a){$("#crm_kayityer").val(r.case_way),$("#crm_kayiteden").val(r.full_name),$("#crm_kayittarih").val(r.tarih),$("#crm_sosyalmedya").val(r.sosyalmedya_adi),$("#crm_muhatapad").val(r.adsoyad),$("#crm_tcno").val(r.tc_no),$("#crm_kayittip").val(r.type_name),$("#crm_konu").val(r.case_subject),$("#crm_mesaj").val(r.description),$("#crm_amirnot").val(r.birim_amirin_notlari),$("#crm_personelnot").val(r.birim_personeli_notlari),$("#crm_personelad").val(r.birim_personel_adi),$("#crm_kayitdurum").html(i),$("#crm_iletisimadres").val(r.iletisim_adresi),$("#crmkayit_casemahalle").val(r.mahalle_cbno),$("#crmkayit_casecaddesokak").val(r.cadde_sokak),$("#crmkayit_casebina").val(r.bina_adi),$("#crmkayit_casebinano").val(r.bina_no),$("#crmkayit_caseickapi").val(r.daire_no),$("#crmkayit_caseadrestarif").val(r.adres_aciklama),$("#crmkayit_caseceptel").val(r.cep_tel_no),$("#crmkayit_caseevtel").val(r.ev_tel_no),$("#crmkayit_x_coord").val(r.x_coord),$("#crmkayit_y_coord").val(r.y_coord),$("#crmkayit_ad").val(r.ad),$("#crmkayit_soyad").val(r.soyad),$("#crmkayit_ukbs_id").val(r.ukbs_id),$("#crmkayit_adaparsel").val(r.adaparsel_no);var n=$("#case_print_table").prop("outerHTML");$("#case_print_table").html(crm_replaceFormData(n,e,r.tarih,r.adsoyad,r.tc_no,r.cep_tel_no,r.adres_aciklama,r.type_name,o[0],r.case_subject,r.description,r.birim_amirin_notlari,r.birim_personeli_notlari,r.birim_personel_adi)),$("#crmdetail_mahalle").val(r.mahalle_adi),$("#crmdetail_casecaddesokak").val(r.cadde_sokak),$("#crmdetail_casebina").val(r.bina_adi),$("#crmdetail_casebinano").val(r.bina_no),$("#crmdetail_caseickapi").val(r.daire_no),$("#crmdetail_caseadrestarif").val(r.adres_aciklama),$("#crmdetail_caseadrestarifmobile").val(r.adres_aciklama),$("#crmdetail_caseceptel").val(r.cep_tel_no),$("#crmdetail_caseceptelmobile").val(r.cep_tel_no),$("#tel_href").attr("href","tel:+"+r.cep_tel_no),$("#crmdetail_caseevtel").val(r.ev_tel_no),$("#crmdetail_x_coord").val(r.x_coord),$("#crmdetail_y_coord").val(r.y_coord),$("#crmdetail_ad").val(r.ad),$("#crmdetail_soyad").val(r.soyad),$("#crmdetail_ukbs_id").val(r.ukbs_id),$("#crmdetail_adaparsel").val(r.adaparsel_no),$("#crmdetail_kisitipid").val(r.kisitip),$("#crmhidden_casetypeid").val(r.flexity_dosyaTuruId),$("#crm_casetypedrop_mobile").val(r.case_type),r.flexity_aktarildi&&($("#crmkayit_flexity").html("Kayıt Flexity'e aktarıldı"),$("#crmkayit_flexity").attr("disabled","disabled"),$("#crmkayit_guncelle").attr("disabled","disabled"),$("#crmkayit_durum").attr("disabled","disabled"),$("#crm_casetypedrop").attr("disabled","disabled"),$("#warning_flexity").show(),$("#crmdetail_flexity").html("Kayıt Flexity'e aktarıldı"),$("#crmdetail_flexity").attr("disabled","disabled"),$("#crmdetail_guncelle").attr("disabled","disabled"),$("#crmdetail_durum").attr("disabled","disabled")),console.log(r.detaillevel1),console.log(r.detaillevel2),"true"!=r.detaillevel1&&($("#crmdetail_flexity").attr("style","display:none !important;"),$("#crmdetail_test").attr("style","display:none !important;"),$("#crm_casekayittipdetayli").attr("style","display:none !important;"),$("#crm_casekayittipdetaylimobile").attr("style","display:none !important;"),$("#crm_konu").attr("disabled","disabled"),$("#crm_mesaj").attr("disabled","disabled"),$("#crmonizle_duplicate_case").attr("style","display:none !important;"),"true"==r.detaillevel2?($("#crm_konu").removeAttr("disabled"),$("#crm_mesaj").removeAttr("disabled"),$("#crmdetail_caseadrestarif").removeAttr("disabled"),$("#crm_casekayitdurumdetayli").attr("style","display:none !important;")):(console.log("bbbb"),$("#crm_sosyalmedya_detayli").attr("style","display:none !important;"),$(".crm_detail_kayittip").attr("style","display:none !important;"),$("#document_delete").attr("style","display:none !important;")))}else $("#crmonizle_kayitno").val("#"+r.case_id),$("#crmonizle_basvurusahibi").val(r.adsoyad),$("#crmonizle_basvurutipi").val(r.type_name),$("#crmonizle_aciklama").val(r.description),$("#crmonizle_konu").val(r.case_subject),$("#crmonizle_durum").html(i),$("#crmonizle_konu").val(r.case_subject),$("#crmonizle_x_coord").val(r.x_coord),$("#crmonizle_y_coord").val(r.y_coord),$("#crmonizlehidden_casetypeid").val(r.flexity_dosyaTuruId),$("#crmonizlehidden_kisitipid").val(r.kisitip),fileUploadType="1",crm_casedetayid=r.case_id;$("#crmyokalert").hide()})})}function CloseAlertTab(e){$(e).hide()}function ukbsFindAllSbsMuhatap(e){$.getJSON(serviceurl+"?method=crm_ukbsFindAllSbsMuhatap&token="+token+"&param1="+e,function(e){$.each(e,function(e,a){window.localStorage.setItem("markamodelvarmi","1")})})}function getCRMCaseStatus(){String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})};$.getJSON(serviceurl+"?method=crm_getCRMCaseStatus&token="+token,function(e){$.each(e,function(e,a){$('<li><a href="#"><span class="label" style="font-size:11px;border-radius:4px;font-weight:bold;color:#fff;padding:4px;background-color:{0};display:block;margin:1px;border-radius:0px;">{1}</span></a></li>'.format(a.color,a.status_name)).appendTo("#crm_kayittipdrop"),$("#filtredurum").append($("<option>",{value:a.status_name,text:a.status_name}))})})}function crm_updateCRMCase(e,a,t,r,o,i,n,s,l,c,d,m,p,u,_,g){var y="";String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})};var f=e.split("-");e=f[0];var h=f[1],k="",b="",v="",w="",x="",C=r;2==t?(k=e,r=""):b=e,3!=t&&(v=r,w=o,x=i),crm_postCRMCaseHistory(b,a,k,v,w,x,n,s,l,c,d,m,p,u),$.getJSON(serviceurl+"?method=crm_updateCRMCase&token="+token+"&param1="+e+"&param2="+a+"&param3="+t+"&param4="+r+"&param5="+o+"&param6="+i+"&param7="+n+"&param8="+s+"&param9="+l+"&param10="+c+"&param11="+d+"&param12="+m+"&param13="+p+"&param14="+u+"&param15="+g,function(r){$.each(r,function(r,o){window.localStorage.setItem("postsuccess",o.postsuccess),window.localStorage.getItem("postsuccess")>0?(1==t?(toastr.success("CRM kayıt durumu güncellendi.","BAŞARILI!"),y='<span class="label" style="font-size:11px;border-radius:4px;font-weight:bold;color:#fff;padding:4px;background-color:{0}">{1}</span>',$("#crm_kayitdurum").html(""),$(y.format(h,e)).appendTo("#crm_kayitdurum")):2==t?(toastr.success("CRM kayıt tipi güncellendi.","BAŞARILI!"),$("#crm_kayittip").val(C)):3==t||toastr.success("CRM kayıt durumu güncellendi.","BAŞARILI!"),crm_getCRMCaseHistory(a)):1==t?toastr.error("CRM kayıt durumu güncellenirken bir hata oluştu, lütfen yeniden deneyiniz.","DİKKAT!"):2==t?toastr.error("CRM kayıt tipi güncellenirken bir hata oluştu, lütfen yeniden deneyiniz.","DİKKAT!"):3==t||toastr.error("CRM bilgileri güncellenirken bir hata oluştu, lütfen yeniden deneyiniz.","DİKKAT!")})})}function crm_getCaseTypeList(e){String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})};var a="",t="";$.getJSON(serviceurl+"?method=crm_getCaseTypeGroup&token="+token,function(r){var o="<option>Kayıt Tipi Değiştir</option>";$.each(r,function(e,r){var i=r.birim_adi;t!=i&&""!=t&&(o+="</optgroup>"),-1==a.indexOf(i)&&(o+="<optgroup label="+i+">",a+=i,t=i);var n=r.type_name;o+="<option value="+r.case_type_id+">"+n+"</option>"}),null!=e&&""!=e?$(e).html(o):($("#crm_casetypedrop").html(o),$("#crm_casetypedrop_mobile").html(o))})}function crm_postToFlexity(e,a,t,r,o,i,n,s,l,c,d,m,p,u,_,g,y,f,h,k,b,v){String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})};$.getJSON(serviceurl+"?method=crm_postToFlexity&token="+token+"&konuBaslik="+e+"&konuAciklama="+a+"&adi="+t+"&soyadi="+r+"&telefon="+o+"&cepTelefonu="+i+"&ukbs_id="+n+"&mahalle="+s+"&csbm="+l+"&binano="+c+"&bina="+d+"&daireno="+m+"&ada="+p+"&parsel="+u+"&acikadres="+_+"&x_coord="+g+"&y_coord="+y+"&iletisim_adres="+h+"&tc_no="+k+"&case_id="+f+"&casetypeid="+b+"&kisitip="+v,function(e){var a=0;e.success?(toastr.success("CRM kaydı Flexity tarafına yönlendirildi.","BAŞARILI!"),$("#crmdetail_flexity").html("Kayıt Flexity'e aktarıldı"),$("#crmdetail_flexity").attr("disabled","disabled"),$("#crmdetail_guncelle").attr("disabled","disabled"),$("#crmdetail_durum").attr("disabled","disabled"),$("#crmonizle_flexity").attr("disabled","disabled"),$("#crm_casetypedrop").attr("disabled","disabled"),$.each(e,function(e,t){0==a&&crm_updateCRMCase("FLEXITY",f,3,t.inbWebDosyaDto.guvenlikKodu,t.inbWebDosyaDto.dosyaNo,t.inbWebDosyaDto.id),a++})):toastr.error("CRM kaydı yönlendirmesinde hata ile karşılaşıldı","DİKKAT!")})}function crm_getFromFlexity(e){String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})};var a=0;console.log("girdi"),$.getJSON(serviceurl+"?method=crm_getFromFlexity&token="+token+"&param1="+e,function(e){for(var t="",r=0;r<e.length;r++)1==e[r].postsuccess&&(t=e[r].case_id+",",a++);""!=t&&(t=t.substring(0,t.length-1));e.length;a>0?(toastr.success(a+" adet kayıt güncellendi.("+t+") ","BAŞARILI!"),loadUrl2PageContent("/modules/crm/case_list.html")):toastr.warning("Tüm kayıtlar güncel durumdadır.","FLEXITY GÜNCELLEMESİ")})}function crm_getHistoryFromFlexity(e){String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})};console.log("girdi"),$.getJSON(serviceurl+"?method=crm_getHistoryFromFlexity&token="+token+"&param1="+e,function(e){})}function crm_postCRMCaseHistory(e,a,t,r,o,i,n,s,l,c,d,m,p,u,_){var g="";String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})};var y=e.split("-");e=y[0];var f=y[1];$.getJSON(serviceurl+"?method=crm_postCRMCaseHistory&token="+token+"&param1="+a+"&param2="+r+"&param3="+o+"&param4="+r+"&param5="+t+"&param6="+e+"&param7="+l+"&param8="+c+"&param9="+d+"&param10="+m+"&param11="+p+"&param12="+_+"&param13="+u+"&param14="+i+"&param15="+n+"&param16="+s+"&param17="+i,function(a){$.each(a,function(a,t){window.localStorage.setItem("postsuccess",t.postsuccess),window.localStorage.getItem("postsuccess")>0?1==type?(toastr.success("CRM kayıt durumu güncellendi.","BAŞARILI!"),g='<span class="label" style="font-size:11px;border-radius:4px;font-weight:bold;color:#fff;padding:4px;background-color:{0}">{1}</span>',$("#crm_kayitdurum").html(""),$(g.format(f,e)).appendTo("#crm_kayitdurum")):2==type?(toastr.success("CRM kayıt tipi güncellendi.","BAŞARILI!"),$("#crm_kayittip").val(r)):3==type||toastr.success("CRM kayıt durumu güncellendi.","BAŞARILI!"):1==type?toastr.error("CRM kayıt durumu güncellenirken bir hata oluştu, lütfen yeniden deneyiniz.","DİKKAT!"):2==type?toastr.error("CRM kayıt tipi güncellenirken bir hata oluştu, lütfen yeniden deneyiniz.","DİKKAT!"):3==type||toastr.error("CRM bilgileri güncellenirken bir hata oluştu, lütfen yeniden deneyiniz.","DİKKAT!")})})}function crm_getCRMCaseHistory(e){String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})};$("#islem_gecmis").html(""),$.getJSON(serviceurl+"?method=crm_getCRMCaseHistory&token="+token+"&param1="+e,function(e){$.each(e,function(e,a){for(var t=0;t<a.length;t++)$('<div class="card" style=\'margin:0;\'><div class="card-header" style=\'padding:12px 20px; background-color: rgba(0, 0, 0, 0.03);\'><h6 data-toggle="collapse" data-parent="#accordion" href="#collapse{2}" class="panel-title expand"><div class="right-arrow pull-right">+</div><a href="#">{0}</a></h6></div><div id="collapse{2}" class="panel-collapse collapse"><div class="card-body" style=\'padding:0px 0 0 25px;\'><div id="casebirimchild{2}">{1}</div></div></div></div>'.format(a[t].recordhistory,a[t].updatesql,t)).appendTo("#islem_gecmis")})})}function crm_updateCRMPerson(e,a,t,r,o,i,n,s,l,c,d){$.getJSON(serviceurl+"?method=crm_updateCRMPerson&token="+token+"&param1="+e+"&param2="+a+"&param3="+t+"&param4="+r+"&param5="+o+"&param6="+i+"&param7="+n+"&param8="+s+"&param9="+l+"&param10="+c+"&param11="+d,function(e){$.each(e,function(e,a){a.postsuccess>0?(toastr.success("CRM muhatap kaydı güncellendi.","BAŞARILI!"),window.localStorage.removeItem("crm_personid"),window.localStorage.removeItem("crm_remember"),window.localStorage.removeItem("crm_recordtype")):toastr.error("CRM muhatap kaydı güncellemesi sırasında bir hata oluştu, lütfen girdiğiniz alanları tekrar kontrol ediniz.","DİKKAT!")})})}function crm_getCRMCaseDocument(e){$("#crm_document_table").DataTable({responsive:!0,serverSide:!0,pageLength:10,destroy:!0,processing:!0,order:[[1,"desc"]],language:{url:"/assets/turkish.json"},ajax:{url:serviceurl+"?method=crm_getCRMCaseDocument&token="+token+"&param1="+e,type:"GET",data:function(e){}},columns:[{data:"0",mRender:function(e,a,t){var r=t[0];return r.indexOf("uimg")>-1&&(r="https://cbs.kocasinan.bel.tr"+r),"<span class='btn btn-warning text-center text-black' onclick='Url2Modal(\""+r+'","Image","")\'>Döküman <span class="fa fa-folder-open"></span></span>'}},{data:"1"},{data:"2"},{data:"0",mRender:function(e,a,t){var r=t[3],o=t[4],i=t[5],n=t[6],s="";return"true"!=i?"true"==n&&(s="<span id='document_delete' class='btn btn-danger text-center text-white' onclick='UpdateCrmCaseDocument("+r+","+o+')\'>Sil <span class="fa fa-remove"></span></span>'):s="<span id='document_delete' class='btn btn-danger text-center text-white' onclick='UpdateCrmCaseDocument("+r+","+o+')\'>Sil <span class="fa fa-remove"></span></span>',s}}],columnDefs:[{width:"20%",orderable:!1,targets:0},{width:"10%",orderable:!1,className:"onem",targets:1},{width:"10%",orderable:!1,targets:2},{width:"3%",orderable:!1,targets:3}]})}function getAgentsQueue(e,a,t,r,o){null==e&&(e=""),null==a&&(a=""),null==t&&(t=""),null==r&&(r=""),null==o&&(o="");$("#crm_queuelist").DataTable({responsive:!0,ordering:!0,searching:!1,destroy:!0,serverSide:!0,processing:!0,order:[[0,"desc"]],language:{url:"/assets/turkish.json"},ajax:{url:serviceurl+"?method=crm_getAgentsQueue&token="+token+"&startdate="+e+"&enddate="+a,type:"GET",data:function(e){e.durum=t,e.siratip=r,e.searchvalue=o}},columns:[{data:"0"},{data:"1"},{data:"2"},{data:"3"},{data:"4"},{data:"5"},{data:"6",mRender:function(e,a,t){return'<a class="btn btn-warning btn-sm" target=ses href="http://192.168.0.71/ses.php?file='+t[6]+"&calldate="+t[7]+"&calltime="+t[8]+'">İndir</a>'}}],columnDefs:[{width:"3%",orderable:!1,"max-width":"30px",targets:0},{width:"18%",orderable:!1,targets:1},{width:"10%",orderable:!1,targets:2},{width:"7%",orderable:!1,targets:3},{width:"5%",orderable:!1,"max-width":"50px;",targets:4},{width:"7%",orderable:!1,targets:5},{width:"7%",orderable:!1,targets:6}]})}function openCRMNewRecord(e,a){window.localStorage.setItem("crm_personid",e),window.localStorage.setItem("crm_remember",1),window.localStorage.setItem("crm_recordtype",a),$("#yenicrm").show(),loadUrl2PageContent("modules/crm/case_new.html")}function load_js(e){var a=document.getElementsByTagName("head")[0],t=document.createElement("script");t.src=e,a.appendChild(t)}function getCrmSosyalMedya(){$.getJSON(serviceurl+"?method=crm_getCrmSosyalMedya&token="+token,function(e){$.each(e,function(e,a){$("#crmkayit_sosyalmedya").append("<option value="+a.sosyalmedya_id+">"+a.sosyalmedya_adi+"</option>")})})}function crm_getUAVTAdresBilgisi(e){$("#uavt_table").DataTable({responsive:!0,serverSide:!0,order:[[0,"asc"]],pageLength:10,destroy:!0,processing:!0,order:[[1,"desc"]],language:{url:"/assets/turkish.json"},ajax:{url:serviceurl+"?method=crm_getUAVTAdresBilgisi&token="+token+"&param1="+e,type:"GET",data:function(e){}},columns:[{data:"0"},{data:"1"},{data:"2"},{data:"3"},{data:"4"},{data:"5"},{data:"6"},{data:"7"},{data:"8"},{data:"9"},{data:"10"},{data:"11"},{data:"12"}],columnDefs:[{width:"20%",orderable:!1,targets:0},{width:"10%",orderable:!1,className:"onem",targets:1},{width:"10%",orderable:!1,targets:2}]})}function crm_postDebugLog(e,a){String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(a,t){return e[t]})};$.getJSON(serviceurl+"?method=crm_PostDebugLog&token="+token+"&param1="+e+"&param2="+a,function(e){$.each(e,function(e,a){})})}function crm_replaceFormData(e,a,t,r,o,i,n,s,l,c,d,m,p,u){return null==m&&(m="-"),null==p&&(p="-"),null==u&&(u="-"),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("{frm_case_subject}",c)).replace("{frm_case_id}",a)).replace("{frm_case_date}",t)).replace("{frm_case_muhatap}",r)).replace("{frm_case_tcno}",o)).replace("{frm_case_telefon}",i)).replace("{frm_case_adres}",n)).replace("{frm_case_kayittip}",s)).replace("{frm_case_durum}",l)).replace("{frm_case_subject}",c)).replace("{frm_case_aciklama}",d)).replace("{frm_case_amirnot}",m)).replace("{frm_case_personelnot}",p)).replace("{frm_case_personelad}",u)}function printDiv(e){if(navigator.userAgent.search("Chrome")>=0){var a=document.getElementById(e);(t=window.open("","Print-Window")).document.open(),t.document.write('<html><body onload="window.print()">'+a.innerHTML+"</body></html>"),t.document.close(),setTimeout(function(){t.close()},10)}else if(navigator.userAgent.search("Firefox")>=0){var t;a=document.getElementById(e);(t=window.open("","Title","width=9999,height=9999")).document.write("<head></head><body></body>");var r=$(t.document.body);r.html(a.innerHTML),r.find(".remove_print").remove(),t.print()}}function printTest(){var e=window.open("","Title","width=9999,height=9999");e.document.write("<head></head><body></body>");var a=$(e.document.body);a.html("<h1>TEST</h1><text class='remove_print'>yeah</text>"),a.find(".remove_print").remove(),e.print()}function crm_postTCNoDogrula(e,a,t,r){var o=0;return $.getJSON(serviceurl+"?method=crm_postTCNoDogrula&token="+token+"&param1="+e+"&param2="+a+"&param3="+t+"&param4="+r,function(e){$.each(e,function(e,a){"1"!=a.postsuccess&&toastr.error(a.message,"DİKKAT!"),o=a.postsuccess})}),o}function UpdateCrmCaseDocument(e,a){$.getJSON(serviceurl+"?method=crm_UpdateCrmCaseDocument&token="+token+"&param1="+e+"&param2="+a,function(a){$.each(a,function(a,t){"1"!=t.postsuccess?toastr.error("Döküman silinirken bir hata oluştu, lütfen bir süre sonra tekrar deneyiniz.","DİKKAT!"):(toastr.success("Döküman silinme işlemi başarılı","BAŞARILI!"),crm_getCRMCaseDocument(e)),returnValue=t.postsuccess})})}function CRMPersontoCaseCombine(){$.getJSON(serviceurl+"?method=crm_updateCRMPersontoCaseCombine&token="+token,function(e){$.each(e,function(e,a){"1"!=a.postsuccess?toastr.error("Mükerrer kayıt bulunamadı.","DİKKAT!"):toastr.success("Mükerrer kayıt bilgileri birleştirildi!","BAŞARILI!"),returnValue=a.postsuccess})})}window.localStorage.setItem("talepsuccess","");